<!DOCTYPE html><html lang="en" class="px-4 py-4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7385e8d9d3c5518f-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="stylesheet" href="/_next/static/css/166b80320d28fa0e.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-024c71c063ddb8d8.js"/><script src="/_next/static/chunks/4bd1b696-cab4ecae4e217186.js" async=""></script><script src="/_next/static/chunks/517-666a7133af59f943.js" async=""></script><script src="/_next/static/chunks/main-app-e43ba8f775b7cf0c.js" async=""></script><script src="/_next/static/chunks/839-4366cacede800037.js" async=""></script><script src="/_next/static/chunks/565-d106929a3b04f825.js" async=""></script><script src="/_next/static/chunks/app/layout-95398f2090e45e4b.js" async=""></script><meta name="next-size-adjust"/><title>[REPORT] [ONGOING] Going to the gym with MLIR: Lifting and lowering Dex executable instructions</title><meta name="description" content="Built with NextJS, TailwindCSS, and a tonnn of loveee :)"/><link rel="icon" href="/_next/static/media/pfp3.5cd65164.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_d4e0c8 flex flex-col min-h-screen"><a href="/"><div class="flex justify-center items-center py-4 "><h1 class="text-4xl font-bold">Jasmine Tang</h1></div></a><div class="flex-1"><article class="p-8 prose  max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto"><div class="flex justify-center text-2xl font-bold "><h2>[REPORT] [ONGOING] Going to the gym with MLIR: Lifting and lowering Dex executable instructions</h2></div><div class="flex justify-start text-xl font-bold underline"><h4>2024-12-07</h4></div><div><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#prologue">Prologue</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#introduction">Introduction</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#planning">Planning</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#parsing-cmdline-and-cmake">Parsing, cmdline and cmake</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#non-mlir-cfg-to-mlir-cfg">Non-MLIR CFG to MLIR CFG</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#optimization">Optimization</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#translation">Translation</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#other-contributions-to-project">Other contributions to project</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#future-work">Future work</a></li></ol></nav><h2 id="prologue"><a href="#prologue">Prologue</a></h2>
<p>Hi there, I hope everyone's having a great day. It's December 2024 in beautiful Berkeley for me. It's time like this that I really wanna go to Japantown and inhale like 20 pieces of takoyaki to get myself into a food coma to relax and forget about the finals I'm having in about a week.</p>
<p>Anyways, this article is about utilizing MLIR in analysing and optimizing the <a href="https://source.android.com/docs/core/runtime/dalvik-bytecode">DEX</a> format.</p>
<p>The blog will be divided into multiple posts. This first one is intended for submission for <a href="https://www2.eecs.berkeley.edu/Courses/CS265/">CS265</a> <a href="https://github.com/mwillsey/cs265">here</a>, while successive posts goes into more depth about implementation details and act somewhat as a tutorial than a project report.</p>
<h2 id="introduction"><a href="#introduction">Introduction</a></h2>
<p>The MLIR project from the LLVM framework provides a framework for building reusable and extensible compiler infrastructure. New intermediate representation can be created and used within the framework itself, allowing for a unified handling of different IRs within the same framework.</p>
<p>In the case of the library <a href="https://github.com/Shuriken-Group/Shuriken-Analyzer">Shuriken</a> from <a href="https://github.com/Shuriken-Group">Shuriken Group</a> for Dalvik Executable (DEX) file analysis, we can leverage the MLIR by extending a somewhat 1-to-1 mapping of DEX to MLIR, the newly created IR (MjolnIR), allowing us to use the much more mature framework for analyzing the binary itself. As DEX is used as a mean for transportation from a server to an android device where it is compiled into ART for installation, being able to optimize the bytecode size of dex allows us to save cost on networking as well as server and android device's storage cost.</p>
<p>In the future, MjolnIR will be used in optimization, obsfucating, deobsfucating the Dalvik Machine Bytecode.</p>
<p>This blog post wouldn't be possible without the guidance of Eduardo (Edu) Blázquez González (Fare9), (<a href="https://farena.in/">Eduardo</a>), a PhD doctorate and a compiler engineer at Quarkslab in developing, lifting and lowering the IR.</p>
<p>Edu's the one that reached out to me on twitter to befriend me :) We chatted about compilers and stuff and later he introduced me to the codebase.
He helps me with understanding the codebase infrastructure, together with emotional support and mlir contributions hahahah :)</p>
<p>I am also grateful to <a href="https://www.mwillsey.com/">Max Willsey</a>, the professor of the compiler graduate class CS265, for allowing me, an undergraduate to enroll as well as guiding me on the direction of the project.
Throughout the semester, there were some assignments where I fell behind. I know that opportunities are hard to come by and I really took every lesson to heart.</p>
<p>New information tidbits will come around in different sections to avoid giving too much weight for any single one, keeping the reading flow smooth.</p>
<p>It is also worth noting that successful lifting and lowering of DEX via MLIR remains a demo for now. Much work is needed in supporting the full instruction set of DEX as well as optimization of it.</p>
<p>I hope everyone enjoys.</p>
<h2 id="planning"><a href="#planning">Planning</a></h2>
<p>In analysing the DEX format, we need to parse the DEX file, construct a CFG (non-MLIR), and then translate the CFG to MLIR's CFG, apply some analysis, then <em>translate it to smali</em>, and then translate smali to dex (via 3rd party tool).</p>
<p>The reasoning for this is that smali is an easier output to work with than dex. In dex format, we need to maintain different tables of strings, types, methods and classes in the pre-header before we get to output the actual DEX [TODO_LINK_EDU_PHD].</p>
<p>In smali, all is resolved via text references instead. In such a short amount of time (~ 6 weeks), it's hard to achieve true circular transformation (DEX->MLIR->DEX). We therefore opt for (DEX->MLIR->smali->DEX) first (actually at the time of writing this (Dec 7th 2024), I'm even nervous to see if we can get DEX->MLIR->smali for submission).</p>
<p>With the naming of the MLIR's dialect being MjolnIR, the goal of the project is divided into two fronts:</p>
<ul>
<li>Achieve the circular transformation of: DEX -> MjolnIR (MLIR) -> Smali.</li>
<li>Survey some analysis/optimization provided by MLIR, using our new IR.</li>
</ul>
<p>In parsing the dex and constructing the CFG, the job was done by Edu prior to me joining the team. There was also an effort in lifting some subset of DEX to MLIR in the <a href="https://github.com/Fare9/KUNAI-static-analyzer">KUNAI</a> repo by Edu (recorded <a href="https://www.youtube.com/watch?v=hfqOivYdD40&#x26;ab_channel=LLVM">here</a>).</p>
<p>Therefore, my responsibilities in the project is to setup mlir, port over and maintain the lifting process of DEX, figure out the optimization and lowering.</p>
<p>The mermaid graph shown below details the steps we need to take in the project.</p>
<p>[TODO_INSERT_FLOWCHART_TD_ON_MERMAIDCHART.COM]</p>
<h2 id="parsing-cmdline-and-cmake"><a href="#parsing-cmdline-and-cmake">Parsing, cmdline and cmake</a></h2>
<p>Supposedly, the project will provide a command line tool for user to input in either a path to a DEX file or a folder of DEX file so that the tool can either lift and lower the DEX file(s).</p>
<p>The command line executable is hand-written, with the formatting job done via <a href="https://fmt.dev/11.0/">fmt</a>.</p>
<p>To maintain the build of the project, I opt for CMake, which is both Shuriken's build system and LLVM and MLIR's build system. This allows (somewhat) seamless connection between them.</p>
<h2 id="non-mlir-cfg-to-mlir-cfg"><a href="#non-mlir-cfg-to-mlir-cfg">Non-MLIR CFG to MLIR CFG</a></h2>
<p>A special characteristic of DEX is that it utilizes (almost infinite) virtual registers without caring for stack space.</p>
<p>This allows for a seamless construction of the program's CFG from the DEX format.</p>
<p>After this we translate the code from</p>
<h2 id="optimization"><a href="#optimization">Optimization</a></h2>
<h2 id="translation"><a href="#translation">Translation</a></h2>
<h2 id="other-contributions-to-project"><a href="#other-contributions-to-project">Other contributions to project</a></h2>
<h2 id="future-work"><a href="#future-work">Future work</a></h2></div></article></div><button class="bottom-4 right-4 fixed"><div class="inline text-2xl font-bold border-black border-2 rounded  p-0 m-0 h-100 w-100">⇡⇡</div></button><footer class="footer self-center justify-center gap-2 pt-4 items-center italic "><p>I&#x27;m looking for new grad compiler work, please email at jjasmine@berkeley.edu</p><p>Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)</p></footer><script src="/_next/static/chunks/webpack-024c71c063ddb8d8.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"3:\"$Sreact.fragment\"\n4:I[4839,[\"839\",\"static/chunks/839-4366cacede800037.js\",\"565\",\"static/chunks/565-d106929a3b04f825.js\",\"177\",\"static/chunks/app/layout-95398f2090e45e4b.js\"],\"\"]\n5:I[5244,[],\"\"]\n6:I[3866,[],\"\"]\n7:I[1168,[\"839\",\"static/chunks/839-4366cacede800037.js\",\"565\",\"static/chunks/565-d106929a3b04f825.js\",\"177\",\"static/chunks/app/layout-95398f2090e45e4b.js\"],\"default\"]\n9:I[6213,[],\"OutletBoundary\"]\nb:I[6213,[],\"MetadataBoundary\"]\nd:I[6213,[],\"ViewportBoundary\"]\nf:I[4835,[],\"\"]\n1:HL[\"/_next/static/media/7385e8d9d3c5518f-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n2:HL[\"/_next/static/css/166b80320d28fa0e.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"dRIiu2BEMzgl5DaNmPUwO\",\"p\":\"\",\"c\":[\"\",\"posts\",\"going_to_mlir_gym_1\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"going_to_mlir_gym_1\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$3\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/166b80320d28fa0e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"px-4 py-4\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d4e0c8 flex flex-col min-h-screen\",\"children\":[[\"$\",\"$L4\",null,{\"href\":\"/\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex justify-center items-center py-4 \",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold\",\"children\":\"Jasmine Tang\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}],[\"$\",\"$L7\",null,{}],[\"$\",\"footer\",null,{\"className\":\"footer self-center justify-center gap-2 pt-4 items-center italic \",\"children\":[[\"$\",\"p\",null,{\"children\":\"I'm looking for new grad compiler work, please email at jjasmine@berkeley.edu\"}],[\"$\",\"p\",null,{\"children\":\"Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)\"}]]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"going_to_mlir_gym_1\",\"d\"],[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$3\",\"c\",{\"children\":[\"$L8\",null,[\"$\",\"$L9\",null,{\"children\":\"$La\"}]]}],{},null]},null]},null]},null],[\"$\",\"$3\",\"h\",{\"children\":[null,[\"$\",\"$3\",\"jyAA2XOUNjJNu7i5fcIyG\",{\"children\":[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]]}]]}]]],\"m\":\"$undefined\",\"G\":[\"$f\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"10:T1da5,"])</script><script>self.__next_f.push([1,"\u003cnav class=\"toc\"\u003e\u003col class=\"toc-level toc-level-1\"\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#prologue\"\u003ePrologue\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#planning\"\u003ePlanning\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#parsing-cmdline-and-cmake\"\u003eParsing, cmdline and cmake\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#non-mlir-cfg-to-mlir-cfg\"\u003eNon-MLIR CFG to MLIR CFG\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#optimization\"\u003eOptimization\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#translation\"\u003eTranslation\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#other-contributions-to-project\"\u003eOther contributions to project\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#future-work\"\u003eFuture work\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\u003ch2 id=\"prologue\"\u003e\u003ca href=\"#prologue\"\u003ePrologue\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eHi there, I hope everyone's having a great day. It's December 2024 in beautiful Berkeley for me. It's time like this that I really wanna go to Japantown and inhale like 20 pieces of takoyaki to get myself into a food coma to relax and forget about the finals I'm having in about a week.\u003c/p\u003e\n\u003cp\u003eAnyways, this article is about utilizing MLIR in analysing and optimizing the \u003ca href=\"https://source.android.com/docs/core/runtime/dalvik-bytecode\"\u003eDEX\u003c/a\u003e format.\u003c/p\u003e\n\u003cp\u003eThe blog will be divided into multiple posts. This first one is intended for submission for \u003ca href=\"https://www2.eecs.berkeley.edu/Courses/CS265/\"\u003eCS265\u003c/a\u003e \u003ca href=\"https://github.com/mwillsey/cs265\"\u003ehere\u003c/a\u003e, while successive posts goes into more depth about implementation details and act somewhat as a tutorial than a project report.\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe MLIR project from the LLVM framework provides a framework for building reusable and extensible compiler infrastructure. New intermediate representation can be created and used within the framework itself, allowing for a unified handling of different IRs within the same framework.\u003c/p\u003e\n\u003cp\u003eIn the case of the library \u003ca href=\"https://github.com/Shuriken-Group/Shuriken-Analyzer\"\u003eShuriken\u003c/a\u003e from \u003ca href=\"https://github.com/Shuriken-Group\"\u003eShuriken Group\u003c/a\u003e for Dalvik Executable (DEX) file analysis, we can leverage the MLIR by extending a somewhat 1-to-1 mapping of DEX to MLIR, the newly created IR (MjolnIR), allowing us to use the much more mature framework for analyzing the binary itself. As DEX is used as a mean for transportation from a server to an android device where it is compiled into ART for installation, being able to optimize the bytecode size of dex allows us to save cost on networking as well as server and android device's storage cost.\u003c/p\u003e\n\u003cp\u003eIn the future, MjolnIR will be used in optimization, obsfucating, deobsfucating the Dalvik Machine Bytecode.\u003c/p\u003e\n\u003cp\u003eThis blog post wouldn't be possible without the guidance of Eduardo (Edu) Blázquez González (Fare9), (\u003ca href=\"https://farena.in/\"\u003eEduardo\u003c/a\u003e), a PhD doctorate and a compiler engineer at Quarkslab in developing, lifting and lowering the IR.\u003c/p\u003e\n\u003cp\u003eEdu's the one that reached out to me on twitter to befriend me :) We chatted about compilers and stuff and later he introduced me to the codebase.\nHe helps me with understanding the codebase infrastructure, together with emotional support and mlir contributions hahahah :)\u003c/p\u003e\n\u003cp\u003eI am also grateful to \u003ca href=\"https://www.mwillsey.com/\"\u003eMax Willsey\u003c/a\u003e, the professor of the compiler graduate class CS265, for allowing me, an undergraduate to enroll as well as guiding me on the direction of the project.\nThroughout the semester, there were some assignments where I fell behind. I know that opportunities are hard to come by and I really took every lesson to heart.\u003c/p\u003e\n\u003cp\u003eNew information tidbits will come around in different sections to avoid giving too much weight for any single one, keeping the reading flow smooth.\u003c/p\u003e\n\u003cp\u003eIt is also worth noting that successful lifting and lowering of DEX via MLIR remains a demo for now. Much work is needed in supporting the full instruction set of DEX as well as optimization of it.\u003c/p\u003e\n\u003cp\u003eI hope everyone enjoys.\u003c/p\u003e\n\u003ch2 id=\"planning\"\u003e\u003ca href=\"#planning\"\u003ePlanning\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIn analysing the DEX format, we need to parse the DEX file, construct a CFG (non-MLIR), and then translate the CFG to MLIR's CFG, apply some analysis, then \u003cem\u003etranslate it to smali\u003c/em\u003e, and then translate smali to dex (via 3rd party tool).\u003c/p\u003e\n\u003cp\u003eThe reasoning for this is that smali is an easier output to work with than dex. In dex format, we need to maintain different tables of strings, types, methods and classes in the pre-header before we get to output the actual DEX [TODO_LINK_EDU_PHD].\u003c/p\u003e\n\u003cp\u003eIn smali, all is resolved via text references instead. In such a short amount of time (~ 6 weeks), it's hard to achieve true circular transformation (DEX-\u003eMLIR-\u003eDEX). We therefore opt for (DEX-\u003eMLIR-\u003esmali-\u003eDEX) first (actually at the time of writing this (Dec 7th 2024), I'm even nervous to see if we can get DEX-\u003eMLIR-\u003esmali for submission).\u003c/p\u003e\n\u003cp\u003eWith the naming of the MLIR's dialect being MjolnIR, the goal of the project is divided into two fronts:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAchieve the circular transformation of: DEX -\u003e MjolnIR (MLIR) -\u003e Smali.\u003c/li\u003e\n\u003cli\u003eSurvey some analysis/optimization provided by MLIR, using our new IR.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn parsing the dex and constructing the CFG, the job was done by Edu prior to me joining the team. There was also an effort in lifting some subset of DEX to MLIR in the \u003ca href=\"https://github.com/Fare9/KUNAI-static-analyzer\"\u003eKUNAI\u003c/a\u003e repo by Edu (recorded \u003ca href=\"https://www.youtube.com/watch?v=hfqOivYdD40\u0026#x26;ab_channel=LLVM\"\u003ehere\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eTherefore, my responsibilities in the project is to setup mlir, port over and maintain the lifting process of DEX, figure out the optimization and lowering.\u003c/p\u003e\n\u003cp\u003eThe mermaid graph shown below details the steps we need to take in the project.\u003c/p\u003e\n\u003cp\u003e[TODO_INSERT_FLOWCHART_TD_ON_MERMAIDCHART.COM]\u003c/p\u003e\n\u003ch2 id=\"parsing-cmdline-and-cmake\"\u003e\u003ca href=\"#parsing-cmdline-and-cmake\"\u003eParsing, cmdline and cmake\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eSupposedly, the project will provide a command line tool for user to input in either a path to a DEX file or a folder of DEX file so that the tool can either lift and lower the DEX file(s).\u003c/p\u003e\n\u003cp\u003eThe command line executable is hand-written, with the formatting job done via \u003ca href=\"https://fmt.dev/11.0/\"\u003efmt\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eTo maintain the build of the project, I opt for CMake, which is both Shuriken's build system and LLVM and MLIR's build system. This allows (somewhat) seamless connection between them.\u003c/p\u003e\n\u003ch2 id=\"non-mlir-cfg-to-mlir-cfg\"\u003e\u003ca href=\"#non-mlir-cfg-to-mlir-cfg\"\u003eNon-MLIR CFG to MLIR CFG\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eA special characteristic of DEX is that it utilizes (almost infinite) virtual registers without caring for stack space.\u003c/p\u003e\n\u003cp\u003eThis allows for a seamless construction of the program's CFG from the DEX format.\u003c/p\u003e\n\u003cp\u003eAfter this we translate the code from\u003c/p\u003e\n\u003ch2 id=\"optimization\"\u003e\u003ca href=\"#optimization\"\u003eOptimization\u003c/a\u003e\u003c/h2\u003e\n\u003ch2 id=\"translation\"\u003e\u003ca href=\"#translation\"\u003eTranslation\u003c/a\u003e\u003c/h2\u003e\n\u003ch2 id=\"other-contributions-to-project\"\u003e\u003ca href=\"#other-contributions-to-project\"\u003eOther contributions to project\u003c/a\u003e\u003c/h2\u003e\n\u003ch2 id=\"future-work\"\u003e\u003ca href=\"#future-work\"\u003eFuture work\u003c/a\u003e\u003c/h2\u003e"])</script><script>self.__next_f.push([1,"8:[\"$\",\"article\",null,{\"className\":\"p-8 prose  max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center text-2xl font-bold \",\"children\":[\"$\",\"h2\",null,{\"children\":\"[REPORT] [ONGOING] Going to the gym with MLIR: Lifting and lowering Dex executable instructions\"}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-start text-xl font-bold underline\",\"children\":[\"$\",\"h4\",null,{\"children\":\"2024-12-07\"}]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$10\"}}]]}]\nc:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"[REPORT] [ONGOING] Going to the gym with MLIR: Lifting and lowering Dex executable instructions\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Built with NextJS, TailwindCSS, and a tonnn of loveee :)\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/_next/static/media/pfp3.5cd65164.png\"}]]\na:null\n"])</script></body></html>