<!DOCTYPE html><html lang="en" class="px-4 py-4"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7385e8d9d3c5518f-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="stylesheet" href="/_next/static/css/166b80320d28fa0e.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-024c71c063ddb8d8.js"/><script src="/_next/static/chunks/4bd1b696-cab4ecae4e217186.js" async=""></script><script src="/_next/static/chunks/517-666a7133af59f943.js" async=""></script><script src="/_next/static/chunks/main-app-e43ba8f775b7cf0c.js" async=""></script><script src="/_next/static/chunks/839-4366cacede800037.js" async=""></script><script src="/_next/static/chunks/565-d106929a3b04f825.js" async=""></script><script src="/_next/static/chunks/app/layout-95398f2090e45e4b.js" async=""></script><meta name="next-size-adjust"/><title>[REPORT] [ONGOING] Going to the gym with MLIR: Lifting and lowering Dex executable instructions</title><meta name="description" content="Built with NextJS, TailwindCSS, and a tonnn of loveee :)"/><link rel="icon" href="/_next/static/media/pfp3.5cd65164.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_d4e0c8 flex flex-col min-h-screen"><a href="/"><div class="flex justify-center items-center py-4 "><h1 class="text-4xl font-bold">Jasmine Tang</h1></div></a><div class="flex-1"><article class="p-8 prose  max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto"><div class="flex justify-center text-2xl font-bold "><h2>[REPORT] [ONGOING] Going to the gym with MLIR: Lifting and lowering Dex executable instructions</h2></div><div class="flex justify-start text-xl font-bold underline"><h4>2024-12-07</h4></div><div><nav class="toc"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#prologue">Prologue</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#introduction">Introduction</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#planning">Planning</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#version-control-and-contributions">Version control and contributions</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#goals-and-current-status">Goals and current status</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#mlirs-operations-and-values">MLIR's operations and values</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#operations">Operations</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#values">Values</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#dissecting-mlir">Dissecting MLIR</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#parsing-cmdline-and-cmake">Parsing, cmdline and cmake</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#non-mlir-non-ssa-cfg-to-mlir-ssa-cfg">Non-MLIR, NON-SSA CFG to MLIR-SSA CFG</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#optimization-and-analysis">Optimization and Analysis</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#translation">Translation</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#future-work">Future work</a></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#resources">Resources</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#tutorials">Tutorials</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#documentations">Documentations</a></li></ol></li></ol></nav><h2 id="prologue"><a href="#prologue">Prologue</a></h2>
<p>Hi there, I hope everyone's having a great day, this article is about writing a recompiler with MLIR, utilizing the framework in analysing and optimizing the <a href="https://source.android.com/docs/core/runtime/dalvik-bytecode">DEX</a> format.</p>
<p>The blog is intended as a report submission for <a href="https://www2.eecs.berkeley.edu/Courses/CS265/">CS265</a> <a href="https://github.com/mwillsey/cs265">here</a>. In writing this report, I'm getting more practice on writing high level design docs without concerning readers with code, yayy mee.</p>
<p>I hope everyone enjoys.</p>
<h2 id="introduction"><a href="#introduction">Introduction</a></h2>
<p>The MLIR project from the LLVM framework provides a framework for building reusable and extensible compiler infrastructure, allowing for a unified handling of different IRs within the same framework.</p>
<p>In the case of the library <a href="https://github.com/Shuriken-Group/Shuriken-Analyzer">Shuriken</a> from <a href="https://github.com/Shuriken-Group">Shuriken Group</a> for Dalvik Executable (DEX) file analysis, we can leverage the MLIR by extending a somewhat 1-to-1 mapping of DEX to MLIR, the newly created IR (MjolnIR), allowing us to use the much more mature framework for analyzing the binary itself. As DEX is used as a mean for transportation from a server to an android device where it is compiled into ART for installation, being able to optimize the bytecode size of dex allows us to save cost on networking as well as server and android device's storage cost.</p>
<p>In the future, MjolnIR will be used in optimization, obfuscating, deobfuscating the Dalvik Machine Bytecode.</p>
<p>This blog post wouldn't be possible without the guidance of Eduardo (Edu) Blázquez González (Fare9), (<a href="https://farena.in/">Eduardo</a>), a PhD doctorate and a compiler engineer at Quarkslab in developing, lifting and lowering the IR.
This summer, Edu's the one that reached out to me on twitter to befriend me :) We chatted about compilers and stuff, and later he introduced me to the codebase.
He's been helping me with onboarding the codebase infrastructure, together with emotional support and chatting about life hahahah :)</p>
<p>I am also grateful to <a href="https://www.mwillsey.com/">Max Willsey</a>, the professor of the compiler graduate class CS265, for allowing me, an undergraduate to enroll as well as guiding me on the direction of the project.
Throughout the semester, there were some assignments where I fell behind. I know that opportunities are hard to come by and I really took every lesson to heart. I thank you for your advice and your bet for taking me into the class :)</p>
<p>Much work is needed in supporting the full instruction set of DEX as well as optimization of it. The project report will discuss the current work (which is a subset of the DEX instruction set) as well as future work.</p>
<h2 id="planning"><a href="#planning">Planning</a></h2>
<h3 id="version-control-and-contributions"><a href="#version-control-and-contributions">Version control and contributions</a></h3>
<p>All code for the project is under the <a href="https://github.com/Shuriken-Group/Shuriken-Analyzer">Shuriken Analyzer</a> repository, which is under the <a href="https://github.com/Shuriken-Group">Shuriken Group</a>'s ownership.</p>
<p>The group also includes other projects, such as</p>
<ul>
<li><a href="https://github.com/Shuriken-Group/setup_llvm_tools">LLVM/MLIR dependency fetching tool</a>: To power CI/CD for this project.</li>
<li><a href="https://github.com/Shuriken-Group/shuribot">Telegram bot for Shuriken</a> : for issue filing and status request, as our group's communication is mainly via telegram.</li>
</ul>
<p>My contributions for the project are shown separately via the <a href="https://github.com/Shuriken-Group/Shuriken-Analyzer/issues?q=is%3Aissue+author%3Abadumbatish">issues</a> and <a href="https://github.com/Shuriken-Group/Shuriken-Analyzer/pulls?q=is%3Apr+author%3Abadumbatish">pull requests</a></p>
<h3 id="goals-and-current-status"><a href="#goals-and-current-status">Goals and current status</a></h3>
<p>In analysing the DEX format, we need to parse the DEX file, construct a CFG (non-MLIR, and non-SSA), and then translate the CFG to MLIR's SSA CFG, apply some analysis, then <em>translate it to smali</em>, and then translate smali to dex (via 3rd party tool).</p>
<p>The reasoning for this is that smali is an easier output to work with than dex. In dex format, we need to maintain different tables of strings, types, methods and classes in the pre-header before we get to output the actual DEX [TODO_LINK_EDU_PHD]. To make matters worse, control flow are done via offsets, which disrupts optimization and requires recalculation of offsets.</p>
<p>In smali, all is resolved via text references instead. In such a short amount of time (~ 6 weeks), it's hard to achieve true circular transformation (DEX->MLIR->DEX). I therefore opted for (DEX->MLIR->smali->DEX) first (actually at the time of writing this (Dec 7th 2024), I'm even nervous to see if we can get DEX->MLIR->smali for submission).</p>
<p>With the naming of the MLIR's dialect being MjolnIR, the goal of the project is divided into two fronts:</p>
<ul>
<li>Achieve the circular transformation of: DEX -> MjolnIR (MLIR) -> Smali.</li>
<li>Survey some analysis/optimization provided by MLIR, using our new IR.</li>
</ul>
<p>In parsing the dex and constructing the CFG, the job was done by Edu prior to me joining the team. There was also an effort in lifting some subset of DEX to MLIR in the <a href="https://github.com/Fare9/KUNAI-static-analyzer">KUNAI</a> repo by Edu (recorded <a href="https://www.youtube.com/watch?v=hfqOivYdD40&#x26;ab_channel=LLVM">here</a>).</p>
<p>Therefore, my responsibilities in the project is to setup mlir, port over and maintain the lifting process of DEX, figure out the optimization and lowering aspect.</p>
<p>The diagram shown below details the steps we need to take in the project.</p>
<p><img src="/blogs/mlir_gym_goal.svg" alt="mlir_gym_goal.svg"></p>
<h3 id="mlirs-operations-and-values"><a href="#mlirs-operations-and-values">MLIR's operations and values</a></h3>
<h3 id="operations"><a href="#operations">Operations</a></h3>
<p>MLIR is built on top of these so-called operations.
On the top level, the MLIR features a <code>ModuleOp</code>, which is a container operation of a single graph region.</p>
<p>A region is an ordered list of basic blocks. And a basic block is an ordered list of basic block.</p>
<p>In lifting DEX to MLIR, we think of</p>
<ul>
<li>An input DEX file comprises of ModuleOps, which represent classes.</li>
<li>Each method in the DEX file is a MethodOp, a MjolnIR dialect.</li>
<li>Each method might have control flows, which is made up with basic blocks.</li>
</ul>
<p>Although a simple 1-1 representation, MLIR can feature much more complex hierarchy, as demonstrated below. We however, rely on the rigid structure we've defined for ourselves to simplify the lifting and lowering processes.</p>
<p>The following two diagrams showcases MLIR's fluid structure.
<img src="/blogs/mlir_diagram_1.png" alt="mlir_diagram_1"></p>
<h3 id="values"><a href="#values">Values</a></h3>
<p>An important thing to notice is how is SSA form represented in MLIR, which is done with <code>mlir::Value</code>. Given an operation such as the integer addition
<code>mlir::arith::AddIOp</code>, mlir gives us different accessors such as <code>getLhs()</code>, <code>getRhs()</code>, <code>getResult()</code>. In relation with operations introduced above, the MLIR Language Reference says:</p>
<blockquote>
<p>MLIR is fundamentally based on a graph-like data structure of nodes, called Operations, and edges, called Values.</p>
</blockquote>
<h3 id="dissecting-mlir"><a href="#dissecting-mlir">Dissecting MLIR</a></h3>
<p>Knowing how MLIR's operation and value works plays a crucial role in getting the recompiler working, as lifting, optimizing, and lowering all depend on them.</p>
<p>A pretty full (for our sakes) view of MLIR is shown below:</p>
<p><img src="/blogs/mlir_diagram_2.png" alt="mlir_diagram_2"></p>
<p>Below, I show some demos of some textual MLIR.</p>
<p>From Jemery Kun's tutorial (a pretty cool person and maybe my idol), which the report author heavily relies on:</p>
<pre class="shiki catppuccin-frappe" style="background-color:#303446;color:#c6d0f5" tabindex="0"><code><span class="line"><span style="color:#C6D0F5">func.func @</span><span style="color:#8CAAEE;font-style:italic">main</span><span style="color:#949CBB">(</span><span style="color:#81C8BE">%</span><span style="color:#C6D0F5">arg0: i32</span><span style="color:#949CBB">)</span><span style="color:#81C8BE"> -></span><span style="color:#C6D0F5"> i32 </span><span style="color:#949CBB">{</span><span style="color:#737994;font-style:italic"> // TODO: Explain this</span></span>
<span class="line"><span style="color:#81C8BE">  %</span><span style="color:#EF9F76">0</span><span style="color:#81C8BE"> =</span><span style="color:#C6D0F5"> math</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">ctlz </span><span style="color:#81C8BE">%</span><span style="color:#C6D0F5">arg0 : i32</span></span>
<span class="line"><span style="color:#C6D0F5">  func</span><span style="color:#949CBB">.</span><span style="color:#C6D0F5">return </span><span style="color:#81C8BE">%</span><span style="color:#EF9F76">0</span><span style="color:#C6D0F5"> : i32</span></span>
<span class="line"><span style="color:#949CBB">}</span></span>
<span class="line"></span></code></pre>
<h2 id="parsing-cmdline-and-cmake"><a href="#parsing-cmdline-and-cmake">Parsing, cmdline and cmake</a></h2>
<p>Supposedly, the project will provide a command line tool for user to input in either a path to a DEX file or a folder of DEX file so that the tool can either lift and lower the DEX file(s).</p>
<p>The command line executable is hand-written, with the formatting job done via <a href="https://fmt.dev/11.0/">fmt</a>.</p>
<p>To maintain the build of the project, I opt for CMake, which is both Shuriken's build system and LLVM and MLIR's build system. This allows (somewhat) seamless connection between ours and LLVM's.</p>
<h2 id="non-mlir-non-ssa-cfg-to-mlir-ssa-cfg"><a href="#non-mlir-non-ssa-cfg-to-mlir-ssa-cfg">Non-MLIR, NON-SSA CFG to MLIR-SSA CFG</a></h2>
<blockquote>
<p>From this point forward, referring to non-ssa CFG means that it is non-mlir and vice versa (as MLIR requires SSA form in its CFG).</p>
</blockquote>
<p>A special characteristic of DEX is that it utilizes (almost infinite) virtual registers without caring for stack space.
This allows for a seamless construction of the program's CFG from the DEX format.</p>
<p>After constructing the CFG's non-SSA form, we translate it to MLIR's SSA CFG via Braun's SSA algorithm.</p>
<p>On the high level overview, we keep an <code>MLIR::DenseMap</code> of integers to <code>mlir::Value</code>.
When the original CFG's instructions ask to either read or write to DEX's virtual registers, we either get the value from our map or
create a new value and map the integer variable to said value.</p>
<p>[TODO: Expand on this]</p>
<h2 id="optimization-and-analysis"><a href="#optimization-and-analysis">Optimization and Analysis</a></h2>
<p>In writing an optimization pass, MLIR offers a variety of tools for the job. Different machinery includes <a href="https://mlir.llvm.org/docs/Tutorials/DataFlowAnalysis/">DataFlowAnalysis</a>, <a href="https://mlir.llvm.org/docs/PatternRewriter/">Pattern Rewriters</a>, <a href="https://mlir.llvm.org/docs/PassManagement/">generic operation pass</a>.</p>
<p>In writing up this part of the project, the biggest obstacles is surprisingly not about learning the apis of different optimization tools, but actually verifying MLIR's and ourselves' dialect.</p>
<p>For time management, I'm opting for a simple pattern rewriter to remove all nops: the <code>mlir::applyPatternsAndFoldGreedily</code> pass. Using the pass runs MLIR's verifier on its built-in dialect, triggering a lot of errors on our compiler build. Despite this, fixing this was somewhat straight forward with MLIR's documentation on its operation.</p>
<p>We feel that</p>
<h2 id="translation"><a href="#translation">Translation</a></h2>
<p>In translating from MjolnIR to smali, I opted for a simple out-of-ssa transformation <a href="https://github.com/mwillsey/cs265/blob/2024-fall/lessons/03-ssa.md#converting-out-of-ssa">introduced in class</a>, slightly tweaked to fit MLIR's ssa block arguments fashion:</p>
<pre><code>For every control flow (cf.condbr and cf.br):
 - Copies the current arguments being passed into the true block,
to the actual parameters, which looks like (move* vA, vB)

 - Inserts an instruction that jumps to the true block
if the operand to the instruction is true, which looks like (if-* vX, :block_Y)

 - Copies the current arguments being passed into the false block,
to the actual parameters, which looks like (move* vA, vB)

 - Inserts an instruction that jumps to the false block,
which looks like (goto :block_Y)

The cf.br case simply reduces down to the last two step.
</code></pre>
<p>The following drawing executes the algorithm on an example, handwritten by Jasmine.</p>
<p><img src="/blogs/out_of_ssa.svg" alt="out_of_ssa.svg"></p>
<p>For this part, I think two things that troubles me the most is that</p>
<ul>
<li>No project (to the best of our knowledge) translating from a custom format to smali, combined with no preexisting knowledge of</li>
<li>Connecting a out-of-ssa translation to the mlir's infrastructure and realizing it to actually output smali.</li>
</ul>
<h2 id="future-work"><a href="#future-work">Future work</a></h2>
<p>In retrospect, despite piling work between Berkeley's other hard classes, full time recruiting, leetcoding and interviewing and</p>
<h2 id="resources"><a href="#resources">Resources</a></h2>
<h3 id="tutorials"><a href="#tutorials">Tutorials</a></h3>
<h3 id="documentations"><a href="#documentations">Documentations</a></h3></div></article></div><button class="bottom-4 right-4 fixed"><div class="inline text-2xl font-bold border-black border-2 rounded  p-0 m-0 h-100 w-100">⇡⇡</div></button><footer class="footer self-center justify-center gap-2 pt-4 items-center italic "><p>I&#x27;m looking for new grad compiler work, please email at jjasmine@berkeley.edu</p><p>Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)</p></footer><script src="/_next/static/chunks/webpack-024c71c063ddb8d8.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"3:\"$Sreact.fragment\"\n4:I[4839,[\"839\",\"static/chunks/839-4366cacede800037.js\",\"565\",\"static/chunks/565-d106929a3b04f825.js\",\"177\",\"static/chunks/app/layout-95398f2090e45e4b.js\"],\"\"]\n5:I[5244,[],\"\"]\n6:I[3866,[],\"\"]\n7:I[1168,[\"839\",\"static/chunks/839-4366cacede800037.js\",\"565\",\"static/chunks/565-d106929a3b04f825.js\",\"177\",\"static/chunks/app/layout-95398f2090e45e4b.js\"],\"default\"]\n9:I[6213,[],\"OutletBoundary\"]\nb:I[6213,[],\"MetadataBoundary\"]\nd:I[6213,[],\"ViewportBoundary\"]\nf:I[4835,[],\"\"]\n1:HL[\"/_next/static/media/7385e8d9d3c5518f-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n2:HL[\"/_next/static/css/166b80320d28fa0e.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"yx0YPy5jhlabgSSDMpXC0\",\"p\":\"\",\"c\":[\"\",\"posts\",\"going_to_mlir_gym_1\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"id\",\"going_to_mlir_gym_1\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$3\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/166b80320d28fa0e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"px-4 py-4\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d4e0c8 flex flex-col min-h-screen\",\"children\":[[\"$\",\"$L4\",null,{\"href\":\"/\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex justify-center items-center py-4 \",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold\",\"children\":\"Jasmine Tang\"}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]}],[\"$\",\"$L7\",null,{}],[\"$\",\"footer\",null,{\"className\":\"footer self-center justify-center gap-2 pt-4 items-center italic \",\"children\":[[\"$\",\"p\",null,{\"children\":\"I'm looking for new grad compiler work, please email at jjasmine@berkeley.edu\"}],[\"$\",\"p\",null,{\"children\":\"Built by Jasmine with NextJS, TailwindCSS, and a tonnn of loveee :)\"}]]}]]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"id\",\"going_to_mlir_gym_1\",\"d\"],[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$3\",\"c\",{\"children\":[\"$L8\",null,[\"$\",\"$L9\",null,{\"children\":\"$La\"}]]}],{},null]},null]},null]},null],[\"$\",\"$3\",\"h\",{\"children\":[null,[\"$\",\"$3\",\"sEnwMWZqLEnIKHoB5j4Ja\",{\"children\":[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]]}]]}]]],\"m\":\"$undefined\",\"G\":[\"$f\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"10:T3f6b,"])</script><script>self.__next_f.push([1,"\u003cnav class=\"toc\"\u003e\u003col class=\"toc-level toc-level-1\"\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#prologue\"\u003ePrologue\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#planning\"\u003ePlanning\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#version-control-and-contributions\"\u003eVersion control and contributions\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#goals-and-current-status\"\u003eGoals and current status\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#mlirs-operations-and-values\"\u003eMLIR's operations and values\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#operations\"\u003eOperations\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#values\"\u003eValues\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#dissecting-mlir\"\u003eDissecting MLIR\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#parsing-cmdline-and-cmake\"\u003eParsing, cmdline and cmake\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#non-mlir-non-ssa-cfg-to-mlir-ssa-cfg\"\u003eNon-MLIR, NON-SSA CFG to MLIR-SSA CFG\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#optimization-and-analysis\"\u003eOptimization and Analysis\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#translation\"\u003eTranslation\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#future-work\"\u003eFuture work\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h2\"\u003e\u003ca class=\"toc-link toc-link-h2\" href=\"#resources\"\u003eResources\u003c/a\u003e\u003col class=\"toc-level toc-level-2\"\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#tutorials\"\u003eTutorials\u003c/a\u003e\u003c/li\u003e\u003cli class=\"toc-item toc-item-h3\"\u003e\u003ca class=\"toc-link toc-link-h3\" href=\"#documentations\"\u003eDocumentations\u003c/a\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/li\u003e\u003c/ol\u003e\u003c/nav\u003e\u003ch2 id=\"prologue\"\u003e\u003ca href=\"#prologue\"\u003ePrologue\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eHi there, I hope everyone's having a great day, this article is about writing a recompiler with MLIR, utilizing the framework in analysing and optimizing the \u003ca href=\"https://source.android.com/docs/core/runtime/dalvik-bytecode\"\u003eDEX\u003c/a\u003e format.\u003c/p\u003e\n\u003cp\u003eThe blog is intended as a report submission for \u003ca href=\"https://www2.eecs.berkeley.edu/Courses/CS265/\"\u003eCS265\u003c/a\u003e \u003ca href=\"https://github.com/mwillsey/cs265\"\u003ehere\u003c/a\u003e. In writing this report, I'm getting more practice on writing high level design docs without concerning readers with code, yayy mee.\u003c/p\u003e\n\u003cp\u003eI hope everyone enjoys.\u003c/p\u003e\n\u003ch2 id=\"introduction\"\u003e\u003ca href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe MLIR project from the LLVM framework provides a framework for building reusable and extensible compiler infrastructure, allowing for a unified handling of different IRs within the same framework.\u003c/p\u003e\n\u003cp\u003eIn the case of the library \u003ca href=\"https://github.com/Shuriken-Group/Shuriken-Analyzer\"\u003eShuriken\u003c/a\u003e from \u003ca href=\"https://github.com/Shuriken-Group\"\u003eShuriken Group\u003c/a\u003e for Dalvik Executable (DEX) file analysis, we can leverage the MLIR by extending a somewhat 1-to-1 mapping of DEX to MLIR, the newly created IR (MjolnIR), allowing us to use the much more mature framework for analyzing the binary itself. As DEX is used as a mean for transportation from a server to an android device where it is compiled into ART for installation, being able to optimize the bytecode size of dex allows us to save cost on networking as well as server and android device's storage cost.\u003c/p\u003e\n\u003cp\u003eIn the future, MjolnIR will be used in optimization, obfuscating, deobfuscating the Dalvik Machine Bytecode.\u003c/p\u003e\n\u003cp\u003eThis blog post wouldn't be possible without the guidance of Eduardo (Edu) Blázquez González (Fare9), (\u003ca href=\"https://farena.in/\"\u003eEduardo\u003c/a\u003e), a PhD doctorate and a compiler engineer at Quarkslab in developing, lifting and lowering the IR.\nThis summer, Edu's the one that reached out to me on twitter to befriend me :) We chatted about compilers and stuff, and later he introduced me to the codebase.\nHe's been helping me with onboarding the codebase infrastructure, together with emotional support and chatting about life hahahah :)\u003c/p\u003e\n\u003cp\u003eI am also grateful to \u003ca href=\"https://www.mwillsey.com/\"\u003eMax Willsey\u003c/a\u003e, the professor of the compiler graduate class CS265, for allowing me, an undergraduate to enroll as well as guiding me on the direction of the project.\nThroughout the semester, there were some assignments where I fell behind. I know that opportunities are hard to come by and I really took every lesson to heart. I thank you for your advice and your bet for taking me into the class :)\u003c/p\u003e\n\u003cp\u003eMuch work is needed in supporting the full instruction set of DEX as well as optimization of it. The project report will discuss the current work (which is a subset of the DEX instruction set) as well as future work.\u003c/p\u003e\n\u003ch2 id=\"planning\"\u003e\u003ca href=\"#planning\"\u003ePlanning\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"version-control-and-contributions\"\u003e\u003ca href=\"#version-control-and-contributions\"\u003eVersion control and contributions\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAll code for the project is under the \u003ca href=\"https://github.com/Shuriken-Group/Shuriken-Analyzer\"\u003eShuriken Analyzer\u003c/a\u003e repository, which is under the \u003ca href=\"https://github.com/Shuriken-Group\"\u003eShuriken Group\u003c/a\u003e's ownership.\u003c/p\u003e\n\u003cp\u003eThe group also includes other projects, such as\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Shuriken-Group/setup_llvm_tools\"\u003eLLVM/MLIR dependency fetching tool\u003c/a\u003e: To power CI/CD for this project.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Shuriken-Group/shuribot\"\u003eTelegram bot for Shuriken\u003c/a\u003e : for issue filing and status request, as our group's communication is mainly via telegram.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eMy contributions for the project are shown separately via the \u003ca href=\"https://github.com/Shuriken-Group/Shuriken-Analyzer/issues?q=is%3Aissue+author%3Abadumbatish\"\u003eissues\u003c/a\u003e and \u003ca href=\"https://github.com/Shuriken-Group/Shuriken-Analyzer/pulls?q=is%3Apr+author%3Abadumbatish\"\u003epull requests\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"goals-and-current-status\"\u003e\u003ca href=\"#goals-and-current-status\"\u003eGoals and current status\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIn analysing the DEX format, we need to parse the DEX file, construct a CFG (non-MLIR, and non-SSA), and then translate the CFG to MLIR's SSA CFG, apply some analysis, then \u003cem\u003etranslate it to smali\u003c/em\u003e, and then translate smali to dex (via 3rd party tool).\u003c/p\u003e\n\u003cp\u003eThe reasoning for this is that smali is an easier output to work with than dex. In dex format, we need to maintain different tables of strings, types, methods and classes in the pre-header before we get to output the actual DEX [TODO_LINK_EDU_PHD]. To make matters worse, control flow are done via offsets, which disrupts optimization and requires recalculation of offsets.\u003c/p\u003e\n\u003cp\u003eIn smali, all is resolved via text references instead. In such a short amount of time (~ 6 weeks), it's hard to achieve true circular transformation (DEX-\u003eMLIR-\u003eDEX). I therefore opted for (DEX-\u003eMLIR-\u003esmali-\u003eDEX) first (actually at the time of writing this (Dec 7th 2024), I'm even nervous to see if we can get DEX-\u003eMLIR-\u003esmali for submission).\u003c/p\u003e\n\u003cp\u003eWith the naming of the MLIR's dialect being MjolnIR, the goal of the project is divided into two fronts:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAchieve the circular transformation of: DEX -\u003e MjolnIR (MLIR) -\u003e Smali.\u003c/li\u003e\n\u003cli\u003eSurvey some analysis/optimization provided by MLIR, using our new IR.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn parsing the dex and constructing the CFG, the job was done by Edu prior to me joining the team. There was also an effort in lifting some subset of DEX to MLIR in the \u003ca href=\"https://github.com/Fare9/KUNAI-static-analyzer\"\u003eKUNAI\u003c/a\u003e repo by Edu (recorded \u003ca href=\"https://www.youtube.com/watch?v=hfqOivYdD40\u0026#x26;ab_channel=LLVM\"\u003ehere\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eTherefore, my responsibilities in the project is to setup mlir, port over and maintain the lifting process of DEX, figure out the optimization and lowering aspect.\u003c/p\u003e\n\u003cp\u003eThe diagram shown below details the steps we need to take in the project.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blogs/mlir_gym_goal.svg\" alt=\"mlir_gym_goal.svg\"\u003e\u003c/p\u003e\n\u003ch3 id=\"mlirs-operations-and-values\"\u003e\u003ca href=\"#mlirs-operations-and-values\"\u003eMLIR's operations and values\u003c/a\u003e\u003c/h3\u003e\n\u003ch3 id=\"operations\"\u003e\u003ca href=\"#operations\"\u003eOperations\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eMLIR is built on top of these so-called operations.\nOn the top level, the MLIR features a \u003ccode\u003eModuleOp\u003c/code\u003e, which is a container operation of a single graph region.\u003c/p\u003e\n\u003cp\u003eA region is an ordered list of basic blocks. And a basic block is an ordered list of basic block.\u003c/p\u003e\n\u003cp\u003eIn lifting DEX to MLIR, we think of\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAn input DEX file comprises of ModuleOps, which represent classes.\u003c/li\u003e\n\u003cli\u003eEach method in the DEX file is a MethodOp, a MjolnIR dialect.\u003c/li\u003e\n\u003cli\u003eEach method might have control flows, which is made up with basic blocks.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAlthough a simple 1-1 representation, MLIR can feature much more complex hierarchy, as demonstrated below. We however, rely on the rigid structure we've defined for ourselves to simplify the lifting and lowering processes.\u003c/p\u003e\n\u003cp\u003eThe following two diagrams showcases MLIR's fluid structure.\n\u003cimg src=\"/blogs/mlir_diagram_1.png\" alt=\"mlir_diagram_1\"\u003e\u003c/p\u003e\n\u003ch3 id=\"values\"\u003e\u003ca href=\"#values\"\u003eValues\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eAn important thing to notice is how is SSA form represented in MLIR, which is done with \u003ccode\u003emlir::Value\u003c/code\u003e. Given an operation such as the integer addition\n\u003ccode\u003emlir::arith::AddIOp\u003c/code\u003e, mlir gives us different accessors such as \u003ccode\u003egetLhs()\u003c/code\u003e, \u003ccode\u003egetRhs()\u003c/code\u003e, \u003ccode\u003egetResult()\u003c/code\u003e. In relation with operations introduced above, the MLIR Language Reference says:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMLIR is fundamentally based on a graph-like data structure of nodes, called Operations, and edges, called Values.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"dissecting-mlir\"\u003e\u003ca href=\"#dissecting-mlir\"\u003eDissecting MLIR\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eKnowing how MLIR's operation and value works plays a crucial role in getting the recompiler working, as lifting, optimizing, and lowering all depend on them.\u003c/p\u003e\n\u003cp\u003eA pretty full (for our sakes) view of MLIR is shown below:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blogs/mlir_diagram_2.png\" alt=\"mlir_diagram_2\"\u003e\u003c/p\u003e\n\u003cp\u003eBelow, I show some demos of some textual MLIR.\u003c/p\u003e\n\u003cp\u003eFrom Jemery Kun's tutorial (a pretty cool person and maybe my idol), which the report author heavily relies on:\u003c/p\u003e\n\u003cpre class=\"shiki catppuccin-frappe\" style=\"background-color:#303446;color:#c6d0f5\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003efunc.func @\u003c/span\u003e\u003cspan style=\"color:#8CAAEE;font-style:italic\"\u003emain\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003earg0: i32\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e -\u003e\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e i32 \u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e{\u003c/span\u003e\u003cspan style=\"color:#737994;font-style:italic\"\u003e // TODO: Explain this\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#81C8BE\"\u003e  %\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e math\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003ectlz \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003earg0 : i32\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#C6D0F5\"\u003e  func\u003c/span\u003e\u003cspan style=\"color:#949CBB\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003ereturn \u003c/span\u003e\u003cspan style=\"color:#81C8BE\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#EF9F76\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#C6D0F5\"\u003e : i32\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#949CBB\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"parsing-cmdline-and-cmake\"\u003e\u003ca href=\"#parsing-cmdline-and-cmake\"\u003eParsing, cmdline and cmake\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eSupposedly, the project will provide a command line tool for user to input in either a path to a DEX file or a folder of DEX file so that the tool can either lift and lower the DEX file(s).\u003c/p\u003e\n\u003cp\u003eThe command line executable is hand-written, with the formatting job done via \u003ca href=\"https://fmt.dev/11.0/\"\u003efmt\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eTo maintain the build of the project, I opt for CMake, which is both Shuriken's build system and LLVM and MLIR's build system. This allows (somewhat) seamless connection between ours and LLVM's.\u003c/p\u003e\n\u003ch2 id=\"non-mlir-non-ssa-cfg-to-mlir-ssa-cfg\"\u003e\u003ca href=\"#non-mlir-non-ssa-cfg-to-mlir-ssa-cfg\"\u003eNon-MLIR, NON-SSA CFG to MLIR-SSA CFG\u003c/a\u003e\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFrom this point forward, referring to non-ssa CFG means that it is non-mlir and vice versa (as MLIR requires SSA form in its CFG).\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eA special characteristic of DEX is that it utilizes (almost infinite) virtual registers without caring for stack space.\nThis allows for a seamless construction of the program's CFG from the DEX format.\u003c/p\u003e\n\u003cp\u003eAfter constructing the CFG's non-SSA form, we translate it to MLIR's SSA CFG via Braun's SSA algorithm.\u003c/p\u003e\n\u003cp\u003eOn the high level overview, we keep an \u003ccode\u003eMLIR::DenseMap\u003c/code\u003e of integers to \u003ccode\u003emlir::Value\u003c/code\u003e.\nWhen the original CFG's instructions ask to either read or write to DEX's virtual registers, we either get the value from our map or\ncreate a new value and map the integer variable to said value.\u003c/p\u003e\n\u003cp\u003e[TODO: Expand on this]\u003c/p\u003e\n\u003ch2 id=\"optimization-and-analysis\"\u003e\u003ca href=\"#optimization-and-analysis\"\u003eOptimization and Analysis\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIn writing an optimization pass, MLIR offers a variety of tools for the job. Different machinery includes \u003ca href=\"https://mlir.llvm.org/docs/Tutorials/DataFlowAnalysis/\"\u003eDataFlowAnalysis\u003c/a\u003e, \u003ca href=\"https://mlir.llvm.org/docs/PatternRewriter/\"\u003ePattern Rewriters\u003c/a\u003e, \u003ca href=\"https://mlir.llvm.org/docs/PassManagement/\"\u003egeneric operation pass\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIn writing up this part of the project, the biggest obstacles is surprisingly not about learning the apis of different optimization tools, but actually verifying MLIR's and ourselves' dialect.\u003c/p\u003e\n\u003cp\u003eFor time management, I'm opting for a simple pattern rewriter to remove all nops: the \u003ccode\u003emlir::applyPatternsAndFoldGreedily\u003c/code\u003e pass. Using the pass runs MLIR's verifier on its built-in dialect, triggering a lot of errors on our compiler build. Despite this, fixing this was somewhat straight forward with MLIR's documentation on its operation.\u003c/p\u003e\n\u003cp\u003eWe feel that\u003c/p\u003e\n\u003ch2 id=\"translation\"\u003e\u003ca href=\"#translation\"\u003eTranslation\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIn translating from MjolnIR to smali, I opted for a simple out-of-ssa transformation \u003ca href=\"https://github.com/mwillsey/cs265/blob/2024-fall/lessons/03-ssa.md#converting-out-of-ssa\"\u003eintroduced in class\u003c/a\u003e, slightly tweaked to fit MLIR's ssa block arguments fashion:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eFor every control flow (cf.condbr and cf.br):\n - Copies the current arguments being passed into the true block,\nto the actual parameters, which looks like (move* vA, vB)\n\n - Inserts an instruction that jumps to the true block\nif the operand to the instruction is true, which looks like (if-* vX, :block_Y)\n\n - Copies the current arguments being passed into the false block,\nto the actual parameters, which looks like (move* vA, vB)\n\n - Inserts an instruction that jumps to the false block,\nwhich looks like (goto :block_Y)\n\nThe cf.br case simply reduces down to the last two step.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe following drawing executes the algorithm on an example, handwritten by Jasmine.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blogs/out_of_ssa.svg\" alt=\"out_of_ssa.svg\"\u003e\u003c/p\u003e\n\u003cp\u003eFor this part, I think two things that troubles me the most is that\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNo project (to the best of our knowledge) translating from a custom format to smali, combined with no preexisting knowledge of\u003c/li\u003e\n\u003cli\u003eConnecting a out-of-ssa translation to the mlir's infrastructure and realizing it to actually output smali.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"future-work\"\u003e\u003ca href=\"#future-work\"\u003eFuture work\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eIn retrospect, despite piling work between Berkeley's other hard classes, full time recruiting, leetcoding and interviewing and\u003c/p\u003e\n\u003ch2 id=\"resources\"\u003e\u003ca href=\"#resources\"\u003eResources\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"tutorials\"\u003e\u003ca href=\"#tutorials\"\u003eTutorials\u003c/a\u003e\u003c/h3\u003e\n\u003ch3 id=\"documentations\"\u003e\u003ca href=\"#documentations\"\u003eDocumentations\u003c/a\u003e\u003c/h3\u003e"])</script><script>self.__next_f.push([1,"8:[\"$\",\"article\",null,{\"className\":\"p-8 prose  max-w-none w-full lg:w-1/2 md:w-4/6 sm:w-5/6 prose-sky mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center text-2xl font-bold \",\"children\":[\"$\",\"h2\",null,{\"children\":\"[REPORT] [ONGOING] Going to the gym with MLIR: Lifting and lowering Dex executable instructions\"}]}],[\"$\",\"div\",null,{\"className\":\"flex justify-start text-xl font-bold underline\",\"children\":[\"$\",\"h4\",null,{\"children\":\"2024-12-07\"}]}],[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$10\"}}]]}]\nc:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"[REPORT] [ONGOING] Going to the gym with MLIR: Lifting and lowering Dex executable instructions\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Built with NextJS, TailwindCSS, and a tonnn of loveee :)\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/_next/static/media/pfp3.5cd65164.png\"}]]\na:null\n"])</script></body></html>